@Library('github.com/releaseworks/jenkinslib') _
pipeline{
    agent any
    stages {
        stage('unit-testing'){
            steps{
            withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: '34893827-b20b-4672-b5f6-9280d73a52c6', usernameVariable: 'AWS_ACCESS_KEY_ID', passwordVariable: 'AWS_SECRET_ACCESS_KEY']]) {
        AWS("--region=eu-west-1 s3 ls")
    }
                bat 'python calcu/test.py'
                bat """ aws configure list"""
            }
        }
        stage('build-package'){
            steps{
                bat """
                sam package --template-file cft.yaml --s3-bucket vignesh-cicd --output-template-file packaged-lambda.yaml
                """
            }
        }
        stage('deploy'){
            steps{
                bat """
                sam deploy --template-file packaged-lambda.yaml --stack-name JenkinPipelineCalculatorApp --capabilities CAPABILITY_IAM
                """
            }
        }
    }
}
